import{p as n,q as e,aR as ae,aS as se,aT as f,aU as G,aV as D,aW as ne,aX as le,aY as ie,aZ as re,a_ as ce,a$ as de,b0 as ue,b1 as ge,b2 as he,b3 as me,b4 as _e,J as fe,b5 as pe,b6 as xe,b7 as Ne,s as Ce,t as P}from"./index-2c5cc3df.js";import{L as H,a as o,b as _,c as L,d as B,e as j,f as p,T as g,g as k,h as be,i as ke,j as Le,k as je,l as ye,m as Se,n as Ee,o as Te,p as q,q as Me,r as F}from"./LexicalLinkPlugin-4e56d474.js";import{A as X}from"./index-64924646.js";import"./SearchOutlined-30b41272.js";import"./useLocale-87a9c90c.js";function Re(t){const i=t.getNodes();return i.length===0?new Set([t.anchor.getNode().getParentOrThrow(),t.focus.getNode().getParentOrThrow()]):new Set(i.map(d=>o.$isElementNode(d)?d:d.getParentOrThrow()))}function Oe(t){const i=o.$getSelection();if(!o.$isRangeSelection(i))return!1;const d=Re(i);let u=0;for(const r of d)if(_.$isListNode(r))u=Math.max(_.$getListDepth(r)+1,u);else if(_.$isListItemNode(r)){const h=r.getParent();if(!_.$isListNode(h))throw new Error("ListMaxIndentLevelPlugin: A ListItemNode must have a ListNode for a parent.");u=Math.max(_.$getListDepth(h)+1,u)}return u<=t}function Ae({maxDepth:t}){const[i]=H.useLexicalComposerContext();return n.useEffect(()=>i.registerCommand(o.INDENT_CONTENT_COMMAND,()=>!Oe(t??7),o.COMMAND_PRIORITY_HIGH),[i,t]),null}function Ie(){const[t]=H.useLexicalComposerContext();return n.useEffect(()=>L.registerCodeHighlighting(t),[t]),null}const $=1,$e=new Set(["paragraph","quote","code","h1","h2","h3","h4","h5","h6","ul","ol"]);function ve(){const[t,i]=n.useState(!1),[d,u]=n.useState("paragraph"),[r,h]=n.useState(!1),[y,S]=n.useState(!1),[m,O]=n.useState(!1),[x,c]=n.useState(!1),[E,T]=n.useState(!1),[A,M]=n.useState(!1),[N,C]=n.useState(!1),[R,U]=n.useState(""),[v,Y]=n.useState(null),[a]=H.useLexicalComposerContext(),w=n.useCallback(()=>{const s=o.$getSelection();if(o.$isRangeSelection(s)){const l=s.anchor.getNode(),b=l.getKey()==="root"?l:l.getTopLevelElementOrThrow(),z=b.getKey();if(a.getElementByKey(z)!==null)if(Y(z),_.$isListNode(b)){const I=B.$getNearestNodeOfType(l,_.ListNode),oe=I?I.getTag():b.getTag();u(oe)}else{const I=j.$isHeadingNode(b)?b.getTag():b.getType();u(I),L.$isCodeNode(b)&&U(b.getLanguage()||L.getDefaultCodeLanguage())}i(s.hasFormat("bold")),c(s.hasFormat("italic")),T(s.hasFormat("underline")),M(s.hasFormat("strikethrough")),C(s.hasFormat("code"));const K=Q(s),te=K.getParent();p.$isLinkNode(te)||p.$isLinkNode(K)?O(!0):O(!1)}},[a]);n.useEffect(()=>B.mergeRegister(a.registerUpdateListener(({editorState:s})=>{s.read(()=>{w()})}),a.registerCommand(o.SELECTION_CHANGE_COMMAND,(s,l)=>(w(),!1),$),a.registerCommand(o.CAN_UNDO_COMMAND,s=>(h(s),!1),$),a.registerCommand(o.CAN_REDO_COMMAND,s=>(S(s),!1),$)),[a,w]);const J=n.useCallback(()=>{m?a.dispatchCommand(p.TOGGLE_LINK_COMMAND,null):a.dispatchCommand(p.TOGGLE_LINK_COMMAND,"https://")},[a,m]),W=s=>{if(s===d)return null;s==="h1"?a.update(()=>{const l=o.$getSelection();o.$isRangeSelection(l)&&(console.log("设置h1"),k.$setBlocksType(l,()=>j.$createHeadingNode("h1")))}):s==="h2"?a.update(()=>{const l=o.$getSelection();o.$isRangeSelection(l)&&k.$setBlocksType(l,()=>j.$createHeadingNode("h2"))}):s==="h3"?a.update(()=>{const l=o.$getSelection();o.$isRangeSelection(l)&&k.$setBlocksType(l,()=>j.$createHeadingNode("h3"))}):s==="code"?a.update(()=>{const l=o.$getSelection();o.$isRangeSelection(l)&&k.$setBlocksType(l,()=>L.$createCodeNode())}):s==="paragraph"?a.update(()=>{const l=o.$getSelection();o.$isRangeSelection(l)&&k.$setBlocksType(l,()=>o.$createParagraphNode())}):s==="ul"?a.dispatchCommand(_.INSERT_UNORDERED_LIST_COMMAND):s==="ol"?a.dispatchCommand(_.INSERT_ORDERED_LIST_COMMAND):s==="quote"&&a.update(()=>{const l=o.$getSelection();o.$isRangeSelection(l)&&k.$setBlocksType(l,()=>j.$createQuoteNode())})},Z=n.useMemo(()=>L.getCodeLanguages(),[]),ee=n.useCallback(s=>{U(s),a.update(()=>{if(v!==null){const l=o.$getNodeByKey(v);L.$isCodeNode(l)&&l.setLanguage(s)}})},[a,v]);return e.jsxs("div",{className:"toolbar_plugin",children:[e.jsx(g,{bordered:!1,color:"white","aria-label":"Undo",className:"toolbar_item "+(r?"active":""),onClick:()=>{a.dispatchCommand(o.UNDO_COMMAND)},children:e.jsx(ae,{style:{opacity:r?1:.5},className:"toolbar_plugin_icon"})}),e.jsx(g,{bordered:!1,color:"white","aria-label":"Redo",className:"toolbar_item "+(y?"active":""),onClick:()=>{a.dispatchCommand(o.REDO_COMMAND)},children:e.jsx(se,{style:{opacity:y?1:.5},className:"toolbar_plugin_icon"})}),$e.has(d)&&e.jsx(g,{bordered:!1,color:"white","aria-label":"Redo",className:"toolbar_item",children:e.jsx(X,{className:"toolbar_node_selector",bordered:!1,value:d,onSelect:W,options:[{value:"paragraph",label:e.jsxs(f,{size:4,align:"start",children:[e.jsx(G,{style:{fontSize:10}}),e.jsx("div",{children:"Normal"})]})},{value:"code",label:e.jsxs(f,{size:4,align:"start",children:[e.jsx(D,{style:{fontSize:10}}),e.jsx("div",{children:"Code"})]})},{value:"ul",label:e.jsxs(f,{size:4,align:"start",children:[e.jsx(ne,{style:{fontSize:10}}),e.jsx("div",{children:"List"})]})},{value:"ol",label:e.jsxs(f,{size:4,align:"start",children:[e.jsx(le,{style:{fontSize:10}}),e.jsx("div",{children:"List"})]})},{value:"quote",label:e.jsxs(f,{size:4,align:"start",children:[e.jsx(ie,{style:{fontSize:10}}),e.jsx("div",{children:"Quote"})]})},{value:"h1",label:e.jsxs(f,{size:4,align:"start",children:[e.jsx(re,{style:{fontSize:10}}),e.jsx("div",{children:"H1"})]})},{value:"h2",label:e.jsxs(f,{size:4,align:"start",children:[e.jsx(ce,{style:{fontSize:10}}),e.jsx("div",{children:"H2"})]})},{value:"h3",label:e.jsxs(f,{size:4,align:"start",children:[e.jsx(de,{style:{fontSize:10}}),e.jsx("div",{children:"H3"})]})}]})}),d==="code"?e.jsx(g,{bordered:!1,color:"white","aria-label":"Redo",className:"toolbar_item",children:e.jsx(X,{className:"toolbar_code_language_selector",bordered:!1,value:R,onSelect:ee,options:Z.map(s=>({value:s,label:e.jsxs(f,{size:4,align:"start",children:[e.jsx(D,{style:{fontSize:10}}),e.jsx("div",{children:s})]})}))})}):e.jsxs(e.Fragment,{children:[e.jsx(g,{bordered:!1,color:"white","aria-label":"Format Bold",className:"toolbar_item "+(t?"active":""),onClick:()=>{a.dispatchCommand(o.FORMAT_TEXT_COMMAND,"bold")},children:e.jsx(ue,{style:{opacity:t?1:.5},className:"toolbar_plugin_icon"})}),e.jsx(g,{bordered:!1,color:"white","aria-label":"Format Italics",className:"toolbar_item "+(x?"active":""),onClick:()=>{a.dispatchCommand(o.FORMAT_TEXT_COMMAND,"italic")},children:e.jsx(ge,{style:{opacity:x?1:.5},className:"toolbar_plugin_icon"})}),e.jsx(g,{bordered:!1,color:"white","aria-label":"Format Underline",className:"toolbar_item "+(E?"active":""),onClick:()=>{a.dispatchCommand(o.FORMAT_TEXT_COMMAND,"underline")},children:e.jsx(he,{style:{opacity:E?1:.5},className:"toolbar_plugin_icon"})}),e.jsxs(g,{bordered:!1,color:"white","aria-label":"Format Strikethrough",className:"toolbar_item "+(A?"active":""),onClick:()=>{a.dispatchCommand(o.FORMAT_TEXT_COMMAND,"strikethrough")},children:[" ",e.jsx(me,{style:{opacity:A?1:.5},className:"toolbar_plugin_icon"})]}),e.jsx(g,{bordered:!1,color:"white","aria-label":"Insert Code",onClick:()=>{a.dispatchCommand(o.FORMAT_TEXT_COMMAND,"code")},className:"toolbar_item "+(N?"active":""),children:e.jsx(D,{style:{opacity:N?1:.5},className:"toolbar_plugin_icon"})}),e.jsx(g,{bordered:!1,color:"white","aria-label":"Insert Link",onClick:J,className:"toolbar_item "+(m?"active":""),children:e.jsx(_e,{style:{opacity:m?1:.5},className:"toolbar_plugin_icon"})}),m&&fe.createPortal(e.jsx(we,{editor:a}),document.body),e.jsx(g,{bordered:!1,color:"white","aria-label":"Left Align",onClick:()=>{a.dispatchCommand(o.FORMAT_ELEMENT_COMMAND,"left")},className:"toolbar_item ",children:e.jsx(pe,{style:{opacity:m?1:.5},className:"toolbar_plugin_icon"})}),e.jsx(g,{bordered:!1,color:"white","aria-label":"Center Align",onClick:()=>{a.dispatchCommand(o.FORMAT_ELEMENT_COMMAND,"center")},className:"toolbar_item ",children:e.jsx(xe,{style:{opacity:m?1:.5},className:"toolbar_plugin_icon"})}),e.jsx(g,{bordered:!1,color:"white","aria-label":"Left Align",onClick:()=>{a.dispatchCommand(o.FORMAT_ELEMENT_COMMAND,"right")},className:"toolbar_item ",children:e.jsx(Ne,{style:{opacity:m?1:.5},className:"toolbar_plugin_icon"})}),e.jsx(g,{bordered:!1,color:"white","aria-label":"Left Align",onClick:()=>{a.dispatchCommand(o.FORMAT_ELEMENT_COMMAND,"justify")},className:"toolbar_item ",children:e.jsx(G,{style:{opacity:m?1:.5},className:"toolbar_plugin_icon"})})]})]})}function Q(t){const i=t.anchor,d=t.focus,u=t.anchor.getNode(),r=t.focus.getNode();return u===r?u:t.isBackward()?k.$isAtNodeEnd(d)?u:r:k.$isAtNodeEnd(i)?r:u}function V(t,i){i===null?(t.style.opacity="0",t.style.top="-1000px",t.style.left="-1000px"):(t.style.opacity="1",t.style.top=`${i.top+i.height+window.pageYOffset+10}px`,t.style.left=`${i.left+window.pageXOffset-t.offsetWidth/2+i.width/2}px`)}function we({editor:t}){const i=n.useRef(null),d=n.useRef(null),u=n.useRef(!1),[r,h]=n.useState(""),[y,S]=n.useState(!1),[m,O]=n.useState(null),x=n.useCallback(()=>{const c=o.$getSelection();if(o.$isRangeSelection(c)){const N=Q(c),C=N.getParent();p.$isLinkNode(C)?h(C.getURL()):p.$isLinkNode(N)?h(N.getURL()):h("")}const E=i.current,T=window.getSelection(),A=document.activeElement;if(E===null)return;const M=t.getRootElement();if(c!==null&&!T.isCollapsed&&M!==null&&M.contains(T.anchorNode)){const N=T.getRangeAt(0);let C;if(T.anchorNode===M){let R=M;for(;R.firstElementChild!=null;)R=R.firstElementChild;C=R.getBoundingClientRect()}else C=N.getBoundingClientRect();u.current||V(E,C),O(c)}else(!A||A.className!=="link-input")&&(V(E,null),O(null),S(!1),h(""));return!0},[t]);return n.useEffect(()=>B.mergeRegister(t.registerUpdateListener(({editorState:c})=>{c.read(()=>{x()})}),t.registerCommand(o.SELECTION_CHANGE_COMMAND,()=>(x(),!0),$)),[t,x]),n.useEffect(()=>{t.getEditorState().read(()=>{x()})},[t,x]),n.useEffect(()=>{y&&d.current&&d.current.focus()},[y]),e.jsx("div",{ref:i,className:"link-editor",children:y?e.jsx("input",{ref:d,className:"link-input",value:r,onChange:c=>{h(c.target.value)},onKeyDown:c=>{c.key==="Enter"?(c.preventDefault(),m!==null&&(r!==""&&t.dispatchCommand(p.TOGGLE_LINK_COMMAND,r),S(!1))):c.key==="Escape"&&(c.preventDefault(),S(!1))}}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"link-input",children:[e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",children:r}),e.jsx("div",{className:"link-edit",role:"button",tabIndex:0,onMouseDown:c=>c.preventDefault(),onClick:()=>{S(!0)}})]})})})}const De={ltr:"e_ltr",rtl:"e_rtl",placeholder:"e_placeholder",paragraph:"e_paragraph",quote:"e_quote",heading:{h1:"e_heading_h1",h2:"e_heading_h2",h3:"e_heading_h3",h4:"e_heading_h4",h5:"e_heading_h5"},table:"e_table",text:{underline:"e_text_underline",strikethrough:"e_text_strikethrough",underlineStrikethrough:"e_text_underlineStrikethrough",code:"e_text_code"},code:"e_node_code",codeHighlight:{atrule:"e_tokenAttr",attr:"e_tokenAttr",boolean:"e_tokenProperty",builtin:"e_tokenSelector",cdata:"e_tokenComment",char:"e_tokenSelector",class:"e_tokenFunction","class-name":"e_tokenFunction",comment:"e_tokenComment",constant:"e_tokenProperty",deleted:"e_tokenProperty",doctype:"e_tokenComment",entity:"e_tokenOperator",function:"e_tokenFunction",important:"e_tokenVariable",inserted:"e_tokenSelector",keyword:"e_tokenAttr",namespace:"e_tokenVariable",number:"e_tokenProperty",operator:"e_tokenOperator",prolog:"e_tokenComment",property:"e_tokenProperty",punctuation:"e_tokenPunctuation",regex:"e_tokenVariable",selector:"e_tokenSelector",string:"e_tokenSelector",symbol:"e_tokenProperty",tag:"e_tokenProperty",url:"e_tokenOperator",variable:"e_tokenVariable"}};const Pe={theme:De,onError(t){throw t},nodes:[j.HeadingNode,j.QuoteNode,_.ListNode,_.ListItemNode,L.CodeNode,L.CodeHighlightNode,p.LinkNode,p.AutoLinkNode,F.TableNode,F.TableRowNode,F.TableCellNode]};function Fe(){return e.jsx(e.Fragment,{children:e.jsx(be.LexicalComposer,{initialConfig:Pe,children:e.jsxs("div",{className:"e-container",children:[e.jsx(ve,{}),e.jsxs("div",{className:"e-inner",children:[e.jsx(ke.RichTextPlugin,{contentEditable:e.jsx(Le.ContentEditable,{className:"e-input"}),placeholder:e.jsx(Be,{}),ErrorBoundary:je}),e.jsx(ye.MarkdownShortcutPlugin,{transformers:Se.TRANSFORMERS}),e.jsx(Ae,{maxDepth:7}),e.jsx(Ee.AutoFocusPlugin,{}),e.jsx(Ie,{}),e.jsx(Te.ListPlugin,{}),e.jsx(q.LinkPlugin,{}),e.jsx(Me.HistoryPlugin,{}),e.jsx(q.LinkPlugin,{})]})]})})})}function Be(){return e.jsx("div",{className:"e_placeholder",children:"Typing..."})}function Xe(){const[t,i]=n.useState("");return console.log(t),e.jsxs(Ce,{children:[e.jsx(P,{xs:0,sm:0,md:0,lg:1,xl:1}),e.jsx(P,{xs:24,sm:24,md:24,lg:22,xl:22,children:e.jsx(Fe,{})}),e.jsx(P,{xs:0,sm:0,md:0,lg:1,xl:1})]})}export{Xe as default};
